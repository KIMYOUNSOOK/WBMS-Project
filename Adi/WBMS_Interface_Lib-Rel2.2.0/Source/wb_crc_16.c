/******************************************************************************
 * @file    wb_crc_16.c
 *
 * @brielf  CRC16 implementation source
 *
 * @details The CRC Logic used in this implementation was provided by
 *          Bastian Molkenthin (www.bastian-molkenthin.de)
 *
 * Copyright (c) 2019-2022 Analog Devices, Inc. All Rights Reserved.
 * This software is proprietary to Analog Devices, Inc. and its licensors.
 *****************************************************************************/

#include "wb_crc_16.h"
#include "wb_crc_config.h"

/******************************************************************************
 * Function Definitions
 *****************************************************************************/

uint16_t wb_crc_ComputeCRC16 (uint8_t const * const pData,
                              uint32_t iLength,
                              uint16_t iSeedValue)
{
    /* Pre-computed CRC16 look up table using polynomial 0xAC9Au */
    static const uint16_t iLUT [] = {
        0x0000u, 0x7956u, 0xF2ACu, 0x8BFAu, 0xBC6Du, 0xC53Bu, 0x4EC1u, 0x3797u,
        0x21EFu, 0x58B9u, 0xD343u, 0xAA15u, 0x9D82u, 0xE4D4u, 0x6F2Eu, 0x1678u,
        0x43DEu, 0x3A88u, 0xB172u, 0xC824u, 0xFFB3u, 0x86E5u, 0x0D1Fu, 0x7449u,
        0x6231u, 0x1B67u, 0x909Du, 0xE9CBu, 0xDE5Cu, 0xA70Au, 0x2CF0u, 0x55A6u,
        0x87BCu, 0xFEEAu, 0x7510u, 0x0C46u, 0x3BD1u, 0x4287u, 0xC97Du, 0xB02Bu,
        0xA653u, 0xDF05u, 0x54FFu, 0x2DA9u, 0x1A3Eu, 0x6368u, 0xE892u, 0x91C4u,
        0xC462u, 0xBD34u, 0x36CEu, 0x4F98u, 0x780Fu, 0x0159u, 0x8AA3u, 0xF3F5u,
        0xE58Du, 0x9CDBu, 0x1721u, 0x6E77u, 0x59E0u, 0x20B6u, 0xAB4Cu, 0xD21Au,
        0x564Du, 0x2F1Bu, 0xA4E1u, 0xDDB7u, 0xEA20u, 0x9376u, 0x188Cu, 0x61DAu,
        0x77A2u, 0x0EF4u, 0x850Eu, 0xFC58u, 0xCBCFu, 0xB299u, 0x3963u, 0x4035u,
        0x1593u, 0x6CC5u, 0xE73Fu, 0x9E69u, 0xA9FEu, 0xD0A8u, 0x5B52u, 0x2204u,
        0x347Cu, 0x4D2Au, 0xC6D0u, 0xBF86u, 0x8811u, 0xF147u, 0x7ABDu, 0x03EBu,
        0xD1F1u, 0xA8A7u, 0x235Du, 0x5A0Bu, 0x6D9Cu, 0x14CAu, 0x9F30u, 0xE666u,
        0xF01Eu, 0x8948u, 0x02B2u, 0x7BE4u, 0x4C73u, 0x3525u, 0xBEDFu, 0xC789u,
        0x922Fu, 0xEB79u, 0x6083u, 0x19D5u, 0x2E42u, 0x5714u, 0xDCEEu, 0xA5B8u,
        0xB3C0u, 0xCA96u, 0x416Cu, 0x383Au, 0x0FADu, 0x76FBu, 0xFD01u, 0x8457u,
        0xAC9Au, 0xD5CCu, 0x5E36u, 0x2760u, 0x10F7u, 0x69A1u, 0xE25Bu, 0x9B0Du,
        0x8D75u, 0xF423u, 0x7FD9u, 0x068Fu, 0x3118u, 0x484Eu, 0xC3B4u, 0xBAE2u,
        0xEF44u, 0x9612u, 0x1DE8u, 0x64BEu, 0x5329u, 0x2A7Fu, 0xA185u, 0xD8D3u,
        0xCEABu, 0xB7FDu, 0x3C07u, 0x4551u, 0x72C6u, 0x0B90u, 0x806Au, 0xF93Cu,
        0x2B26u, 0x5270u, 0xD98Au, 0xA0DCu, 0x974Bu, 0xEE1Du, 0x65E7u, 0x1CB1u,
        0x0AC9u, 0x739Fu, 0xF865u, 0x8133u, 0xB6A4u, 0xCFF2u, 0x4408u, 0x3D5Eu,
        0x68F8u, 0x11AEu, 0x9A54u, 0xE302u, 0xD495u, 0xADC3u, 0x2639u, 0x5F6Fu,
        0x4917u, 0x3041u, 0xBBBBu, 0xC2EDu, 0xF57Au, 0x8C2Cu, 0x07D6u, 0x7E80u,
        0xFAD7u, 0x8381u, 0x087Bu, 0x712Du, 0x46BAu, 0x3FECu, 0xB416u, 0xCD40u,
        0xDB38u, 0xA26Eu, 0x2994u, 0x50C2u, 0x6755u, 0x1E03u, 0x95F9u, 0xECAFu,
        0xB909u, 0xC05Fu, 0x4BA5u, 0x32F3u, 0x0564u, 0x7C32u, 0xF7C8u, 0x8E9Eu,
        0x98E6u, 0xE1B0u, 0x6A4Au, 0x131Cu, 0x248Bu, 0x5DDDu, 0xD627u, 0xAF71u,
        0x7D6Bu, 0x043Du, 0x8FC7u, 0xF691u, 0xC106u, 0xB850u, 0x33AAu, 0x4AFCu,
        0x5C84u, 0x25D2u, 0xAE28u, 0xD77Eu, 0xE0E9u, 0x99BFu, 0x1245u, 0x6B13u,
        0x3EB5u, 0x47E3u, 0xCC19u, 0xB54Fu, 0x82D8u, 0xFB8Eu, 0x7074u, 0x0922u,
        0x1F5Au, 0x660Cu, 0xEDF6u, 0x94A0u, 0xA337u, 0xDA61u, 0x519Bu, 0x28CDu
    };

    /* Storage for return value of this function */
    uint32_t iValue;

    /* Initialise the CRC value with the initial seed */
    iValue = iSeedValue;

    /* Validate input parameters */
    if ((void *) 0 != pData)
    {
        /* LSB configuration for CRC */
        for (uint32_t i = 0u; i < iLength; i++)
        {
            /* XOR-in next input byte into LSB of crc and get this LSB, that's our new intermediate divident */
            /* Shift out the LSB used for division per look-up table and XOR with the remainder */
            iValue = ((iValue >> 8) ^ iLUT [((iValue ^ pData [i]) & 0xFFu)]) & 0xFFFFu;
        }
    }

    /* Return calculated CRC value */
    return (uint16_t) (iValue & 0xFFFFu);
}
